<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全学年対応：学習ドリルアプリ</title>
    <style>
        :root {
            --primary: #4A90E2;
            --secondary: #f5f7fa;
            --accent: #FF6B6B;
            --text: #333;
        }
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
            background-color: var(--secondary);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .container {
            background: white;
            width: 100%;
            max-width: 800px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
        }
        h1, h2 { margin-bottom: 20px; color: var(--primary); }
        
        /* Menu Styles */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-outline { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .back-btn { background: #999; margin-top: 20px; }

        /* Quiz Styles */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }
        .question-box {
            font-size: 24px;
            font-weight: bold;
            margin: 30px 0;
            min-height: 60px;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        /* Result Styles */
        .score-display { font-size: 48px; color: var(--accent); font-weight: bold; }
        .review-list { text-align: left; margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .review-item { border-bottom: 1px solid #eee; padding: 10px; }
        .correct { color: green; }
        .wrong { color: red; }

        /* Utility */
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container" id="app">
    <div id="screen-grade">
        <h1>学習ドリル</h1>
        <p>学年を選んでください</p>
        <div class="menu-grid" id="grade-list"></div>
    </div>

    <div id="screen-subject" class="hidden">
        <h2 id="selected-grade-title"></h2>
        <p>教科を選んでください</p>
        <div class="menu-grid" id="subject-list"></div>
        <button class="btn back-btn" onclick="goBack('grade')">戻る</button>
    </div>

    <div id="screen-unit" class="hidden">
        <h2 id="selected-subject-title"></h2>
        <p>単元を選んでください</p>
        <div class="menu-grid" id="unit-list"></div>
        <button class="btn back-btn" onclick="goBack('subject')">戻る</button>
    </div>

    <div id="screen-quiz" class="hidden">
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        <div style="display:flex; justify-content:space-between;">
            <span id="q-counter"></span>
            <span id="unit-name-display" style="font-size:12px; color:#888;"></span>
        </div>
        <div class="question-box" id="question-text"></div>
        <div class="options-grid" id="options-area"></div>
    </div>

    <div id="screen-result" class="hidden">
        <h2>結果発表</h2>
        <div class="score-display"><span id="score"></span> / <span id="total-q"></span></div>
        <div class="review-list" id="review-area"></div>
        <button class="btn" onclick="resetApp()">トップに戻る</button>
    </div>
</div>

<script>
/**
 * データ構造：
 * drillData[学年][教科][単元] = [ {q: "問題", options: ["選択肢1", "選択肢2"...], a: "正解"} ... ]
 * * ※ ここに約1000問分のデータを格納します。
 * 現在はサンプルとして「小1算数」「中1英語」「小4理科」などの一部にデータを入れています。
 * 他の単元を選択すると「問題準備中」のサンプル問題が出ます。
 */

// ヘルパー：ダミー問題生成（データがない単元用）
function generateDummyQuestions(unitName, count=5) {
    let arr = [];
    for(let i=1; i<=count; i++) {
        arr.push({
            q: `【${unitName}】の問題サンプル ${i} です。<br>1+1は？`,
            options: ["2", "1", "3", "4"],
            a: "2"
        });
    }
    return arr;
}

// === メインデータ（ユーザー提供のリストに基づく） ===
const curriculum = {
    "小学校1年": {
        "国語": ["ひらがなの読み", "ひらがなの書き順", "ことばあそび", "文と文末", "ものがたり文の音読", "かん字"],
        "算数": ["数の認識", "たし算（繰り上がりなし）", "ひき算（繰り下がりなし）", "いくつといくつ", "かたち", "量の比較"],
        "生活": ["学校生活", "安全な生活", "季節と遊び"],
        "音楽": ["校歌", "リズム"],
        "図工": ["クレヨン・絵の具"],
        "体育": ["体ほぐし運動"]
    },
    "小学校2年": {
        "国語": ["漢字の書き取り", "主語・述語", "物語文", "説明文", "日記・作文"],
        "算数": ["2桁のたし算・ひき算", "かけ算（九九）", "長さ(cm/mm)", "時刻と時間", "図形（直角）"],
        "生活": ["町探検", "成長の記録"]
    },
    "小学校3年": {
        "国語": ["心情理解", "国語辞典", "ローマ字", "漢字"],
        "算数": ["かけ算の筆算", "わり算", "重さ(g/kg)", "円と球"],
        "理科": ["身の回りの生物", "風とゴムの力", "太陽の光"],
        "社会": ["市の様子", "地図記号", "方位"]
    },
    "小学校4年": {
        "国語": ["詩の表現", "要約", "漢字"],
        "算数": ["大きな数", "わり算の筆算", "小数のしくみ", "分数", "面積"],
        "理科": ["季節と生物", "水の状態変化", "電気のはたらき"],
        "社会": ["都道府県", "県内の産業", "ごみと水"]
    },
    "小学校5年": {
        "国語": ["物語の構成", "論説文", "要旨", "漢字"],
        "算数": ["小数のかけ算・わり算", "分数の計算", "体積", "割合", "平均"],
        "理科": ["天気の変化", "発芽と成長", "電磁石"],
        "社会": ["日本の地形・気候", "農業・工業", "貿易"]
    },
    "小学校6年": {
        "国語": ["意見文", "古典に親しむ", "漢字"],
        "算数": ["分数の計算", "比", "速さ", "円の面積"],
        "理科": ["人の体", "月と太陽", "電気の利用"],
        "社会": ["日本史", "日本国憲法", "政治と国際社会"]
    },
    "中学校1年": {
        "国語": ["説明文構造", "小説", "古文", "文法"],
        "数学": ["正負の数", "文字式", "一次方程式", "比例・反比例"],
        "理科": ["植物の分類", "光・音", "力"],
        "社会": ["世界地理", "歴史（古代）"],
        "英語": ["be動詞", "一般動詞", "三人称単数"]
    },
    "中学校2年": {
        "国語": ["論説文", "古文", "漢文"],
        "数学": ["連立方程式", "一次関数", "合同"],
        "理科": ["化学変化", "電流", "動物"],
        "社会": ["日本地理", "歴史（江戸）"],
        "英語": ["過去形", "未来表現", "比較"]
    },
    "中学校3年": {
        "国語": ["小説", "古文・漢文", "評論"],
        "数学": ["二次方程式", "二次関数", "三平方の定理"],
        "理科": ["遺伝", "天体", "エネルギー"],
        "社会": ["歴史（近代）", "公民"],
        "英語": ["現在完了", "受動態", "関係代名詞"]
    },
    "高校共通": {
        "国語": ["現代文", "古文", "漢文"],
        "数学": ["数Ⅰ(二次関数)", "数Ⅱ(微積基礎)", "数Ⅲ(極限)"],
        "英語": ["文法総合", "長文読解"]
    }
};

// === 具体的な問題データ（サンプル） ===
// ここに問題を追加していくことで1000問ストックを作ります。
const questionStock = {
    "小学校1年_算数_たし算（繰り上がりなし）": [
        { q: "1 + 2 = ?", options: ["3", "2", "4", "5"], a: "3" },
        { q: "3 + 4 = ?", options: ["7", "6", "8", "5"], a: "7" },
        { q: "5 + 0 = ?", options: ["5", "0", "6", "50"], a: "5" },
        { q: "2 + 6 = ?", options: ["8", "9", "7", "6"], a: "8" },
        { q: "4 + 4 = ?", options: ["8", "4", "0", "16"], a: "8" }
    ],
    "中学校1年_英語_be動詞": [
        { q: "I ( ) a student.", options: ["am", "is", "are", "be"], a: "am" },
        { q: "You ( ) happy.", options: ["are", "is", "am", "be"], a: "are" },
        { q: "He ( ) my teacher.", options: ["is", "am", "are", "were"], a: "is" },
        { q: "They ( ) from Japan.", options: ["are", "is", "am", "was"], a: "are" }
    ],
    "小学校4年_社会_都道府県": [
        { q: "北海道の県庁所在地は？", options: ["札幌市", "函館市", "旭川市", "小樽市"], a: "札幌市" },
        { q: "日本で一番面積が広い県は？", options: ["岩手県", "福島県", "長野県", "新潟県"], a: "岩手県" },
        { q: "「うどん県」として有名なのは？", options: ["香川県", "徳島県", "愛媛県", "高知県"], a: "香川県" }
    ]
};

// === アプリの状態管理 ===
let currentGrade = "";
let currentSubject = "";
let currentUnit = "";
let quizQueue = [];
let currentIndex = 0;
let score = 0;
let userAnswers = [];

// === 初期化と描画 ===
window.onload = function() {
    renderGradeMenu();
};

function renderGradeMenu() {
    const list = document.getElementById('grade-list');
    list.innerHTML = "";
    Object.keys(curriculum).forEach(grade => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.innerText = grade;
        btn.onclick = () => selectGrade(grade);
        list.appendChild(btn);
    });
}

function selectGrade(grade) {
    currentGrade = grade;
    document.getElementById('screen-grade').classList.add('hidden');
    document.getElementById('screen-subject').classList.remove('hidden');
    document.getElementById('selected-grade-title').innerText = grade;
    
    const list = document.getElementById('subject-list');
    list.innerHTML = "";
    Object.keys(curriculum[grade]).forEach(subject => {
        const btn = document.createElement('button');
        btn.className = 'btn btn-outline';
        btn.innerText = subject;
        btn.onclick = () => selectSubject(subject);
        list.appendChild(btn);
    });
}

function selectSubject(subject) {
    currentSubject = subject;
    document.getElementById('screen-subject').classList.add('hidden');
    document.getElementById('screen-unit').classList.remove('hidden');
    document.getElementById('selected-subject-title').innerText = `${currentGrade} > ${subject}`;

    const list = document.getElementById('unit-list');
    list.innerHTML = "";
    curriculum[currentGrade][subject].forEach(unit => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.innerText = unit;
        btn.onclick = () => startDrill(unit);
        list.appendChild(btn);
    });
}

function goBack(to) {
    if(to === 'grade') {
        document.getElementById('screen-subject').classList.add('hidden');
        document.getElementById('screen-grade').classList.remove('hidden');
    } else if (to === 'subject') {
        document.getElementById('screen-unit').classList.add('hidden');
        document.getElementById('screen-subject').classList.remove('hidden');
    }
}

// === ドリル実行ロジック ===
function startDrill(unit) {
    currentUnit = unit;
    
    // キーの生成（データ取得用）
    const dataKey = `${currentGrade}_${currentSubject}_${unit}`;
    
    // データがあればそれを使い、なければダミー生成
    let sourceQuestions = [];
    if (questionStock[dataKey]) {
        sourceQuestions = JSON.parse(JSON.stringify(questionStock[dataKey])); // Deep copy
    } else {
        sourceQuestions = generateDummyQuestions(unit, 10); // データがない場合
    }

    // ランダムシャッフル
    shuffleArray(sourceQuestions);

    // 最大50問を抽出 (ストックが少なければ全問)
    const MAX_QUESTIONS = 50;
    quizQueue = sourceQuestions.slice(0, MAX_QUESTIONS);
    
    currentIndex = 0;
    score = 0;
    userAnswers = [];

    document.getElementById('screen-unit').classList.add('hidden');
    document.getElementById('screen-quiz').classList.remove('hidden');
    document.getElementById('unit-name-display').innerText = unit;

    renderQuestion();
}

function renderQuestion() {
    if (currentIndex >= quizQueue.length) {
        finishDrill();
        return;
    }

    const qData = quizQueue[currentIndex];
    
    // 進捗表示
    const total = quizQueue.length;
    const pct = ((currentIndex) / total) * 100;
    document.getElementById('progress').style.width = `${pct}%`;
    document.getElementById('q-counter').innerText = `第 ${currentIndex + 1} 問 / 全 ${total} 問`;

    // 問題表示
    document.getElementById('question-text').innerHTML = qData.q;

    // 選択肢表示（選択肢もシャッフル）
    const optionsArea = document.getElementById('options-area');
    optionsArea.innerHTML = "";
    
    // 正解を保持しつつシャッフルするための処理
    let choices = [...qData.options];
    shuffleArray(choices);

    choices.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn btn-outline';
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(opt, qData.a, qData.q);
        optionsArea.appendChild(btn);
    });
}

function checkAnswer(selected, correct, questionText) {
    const isCorrect = (selected === correct);
    if (isCorrect) score++;

    userAnswers.push({
        q: questionText,
        selected: selected,
        correct: correct,
        isCorrect: isCorrect
    });

    currentIndex++;
    renderQuestion();
}

function finishDrill() {
    document.getElementById('screen-quiz').classList.add('hidden');
    document.getElementById('screen-result').classList.remove('hidden');

    document.getElementById('score').innerText = score;
    document.getElementById('total-q').innerText = quizQueue.length;

    const reviewArea = document.getElementById('review-area');
    reviewArea.innerHTML = "";

    userAnswers.forEach((ans, idx) => {
        const div = document.createElement('div');
        div.className = 'review-item';
        const status = ans.isCorrect ? '<span class="correct">◯ 正解</span>' : '<span class="wrong">✕ 不正解</span>';
        div.innerHTML = `
            <div><strong>Q${idx+1}:</strong> ${ans.q}</div>
            <div>${status} (あなたの答え: ${ans.selected} / 正解: ${ans.correct})</div>
        `;
        reviewArea.appendChild(div);
    });
}

function resetApp() {
    document.getElementById('screen-result').classList.add('hidden');
    document.getElementById('screen-grade').classList.remove('hidden');
    currentGrade = "";
    currentSubject = "";
    currentUnit = "";
}

// ユーティリティ：配列シャッフル (Fisher-Yates)
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

</script>

</body>
</html>
